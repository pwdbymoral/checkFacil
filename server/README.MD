# ðŸŽ‰ CheckFacil - Backend API

Sistema de gestÃ£o de festas infantis do **EspaÃ§o Criar**, responsÃ¡vel por:
- LÃ³gica de negÃ³cios
- AutenticaÃ§Ã£o via JWT
- GestÃ£o de festas, clientes e convidados
- IntegraÃ§Ãµes com webhooks (n8n)

---

## ðŸ› ï¸ Tecnologias Utilizadas

- **Node.js** â€“ Ambiente de execuÃ§Ã£o JavaScript
- **Express.js** â€“ Framework para criaÃ§Ã£o de APIs
- **Sequelize** â€“ ORM para MySQL
- **MySQL** â€“ Banco de dados relacional
- **JWT** â€“ AutenticaÃ§Ã£o de rotas
- **Axios** â€“ RequisiÃ§Ãµes HTTP (ex: integraÃ§Ã£o com n8n)
- **CORS** â€“ LiberaÃ§Ã£o de origens para o frontend
- **dotenv** â€“ VariÃ¡veis de ambiente
- **bcryptjs** â€“ Hash seguro de senhas
- **Yarn Workspaces** â€“ Monorepo

---

## âš™ï¸ ConfiguraÃ§Ã£o do Ambiente

### âœ”ï¸ PrÃ©-requisitos

- Node.js `v22.x` ou superior  
- Yarn `v4.x` ou superior  
- Banco de dados MySQL ativo  

### ðŸ“¦ InstalaÃ§Ã£o

Na pasta raiz do projeto, rode:

```bash
yarn install
```

### ðŸ” VariÃ¡veis de Ambiente

Crie um arquivo `.env` na pasta `/server` com:

```env
# Banco de Dados
DB_HOST=localhost
DB_USER=seu_usuario_mysql
DB_PASSWORD=sua_senha_mysql
DB_NAME=checkfacil_db
DB_PORT=3306

# JWT
JWT_SECRET=gere_um_segredo_forte_e_aleatorio_aqui

# Porta do Servidor
PORT=3001
```

---

## ðŸš€ ExecuÃ§Ã£o do Projeto

Modo desenvolvimento (somente o backend):

```bash
yarn dev:server
```

Frontend + Backend juntos:

```bash
yarn dev
```

A API estarÃ¡ disponÃ­vel em: [http://localhost:3001](http://localhost:3001)

---

## ðŸ” Endpoints de AutenticaÃ§Ã£o (`/auth`)

> Todas as rotas relacionadas ao login e cadastro de usuÃ¡rios.

| MÃ©todo | Rota Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  | DescriÃ§Ã£o Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  |
|--------|-------------------------------|-----------------------------------------------------------------------|
| POST Â  | `/auth/register/admFesta` Â  Â  | Registra um novo administrador de festa. (Proteger em ProduÃ§Ã£o) Â  Â  Â  |
| POST Â  | `/auth/register/admEspaco` Â  Â  | Registra um novo administrador do espaÃ§o. (Proteger em ProduÃ§Ã£o) Â  Â  |
| POST Â  | `/auth/login` Â  Â  Â  Â  Â  Â  Â  Â   | Realiza login e retorna token JWT. Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   |
| POST Â  | `/auth/definir-senha` Â  Â  Â  Â  | Permite definir senha via token de primeiro acesso. Â  Â  Â  Â  Â  Â  Â  Â   |

#### ðŸ”¸ Exemplo: Cadastro de UsuÃ¡rio (POST `/auth/register/...`)

```json
{
  "nome": "Nome do Administrador",
  "email": "admin@exemplo.com",
  "senha": "senha_forte_aqui",
  "telefone": "79999999999"
}
```

#### ðŸ”¸ Exemplo: Login (POST `/auth/login`)

```json
{
  "email": "admin@exemplo.com",
  "senha": "senha_forte_aqui"
}
```

---

## ðŸŽ‰ Endpoints de Festas (`/festa`)

ðŸ” AutenticaÃ§Ã£o ObrigatÃ³ria para todas as rotas de festa (usar `Authorization: Bearer SEU_TOKEN`).

| MÃ©todo | Rota Â  Â  Â  Â  Â  Â  Â  | DescriÃ§Ã£o Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  |
|--------|--------------------|-----------------------------------------------|
| POST Â  | `/festa/criar` Â  Â  | Cria uma nova festa e associa um cliente. Â  Â  |
| GET Â  Â  | `/festa/listar` Â  | Lista festas com filtros e permissÃµes. Â  Â  Â  |
| GET Â  Â  | `/festa/:idFesta` | Busca os detalhes de uma festa especÃ­fica. Â  |
| PATCH Â  | `/festa/:idFesta` | Atualiza uma festa especÃ­fica. Â  Â  Â  Â  Â  Â  Â  |
| DELETE | `/festa/:idFesta` | Remove uma festa do sistema. Â  Â  Â  Â  Â  Â  Â  Â  |

#### ðŸ”¸ POST `/festa/criar`

DescriÃ§Ã£o: Chamado pelo **AdmEspaco** para iniciar o registo de uma festa. Cria a conta do cliente se o email for novo.

Exemplo de Corpo:

```json
{
  "dadosFesta": {
    "nome_festa": "AniversÃ¡rio Espacial do Lucas",
    "data_festa": "2025-10-15",
    "horario_inicio": "14:00:00",
    "horario_fim": "18:00:00",
    "local_festa": "EspaÃ§o Play + Park",
    "descricao": "Festa temÃ¡tica de astronautas e planetas, com muitas atividades interativas para as crianÃ§as.",
    "pacote_escolhido": "PLAY_MAIS_PARK",
    "numero_adultos_contratado": 25,
    "numero_criancas_contratado": 30,
    "nome_aniversariante": "Lucas",
    "idade_aniversariante": 8,
    "tema_festa": "Aventura no EspaÃ§o",
    "festa_deixa_e_pegue": true,
    "autoriza_uso_imagem": true,
    "instagram_cliente": "@familia_do_lucas",
    "procedimento_convidado_fora_lista": "CHAMAR_ANFITRIAO",
    "link_playlist_spotify": "https://open.spotify.com/playlist/sua_playlist_aqui",
    "observacoes_festa": "O bolo serÃ¡ entregue pelo fornecedor Ã s 13h. Contratado serviÃ§o de fotografia Ã  parte."
  },
  "dadosCliente": {
    "nome": "Carla (MÃ£e do Lucas)",
    "email": "carla.mae.lucas@exemplo.com",
    "telefone": "79911223344"
  }
}
```

---

## ðŸ§‘â€ðŸ¤â€ðŸ§‘ Endpoints de Convidados (`/festa/:idFesta/...`)

> Gerenciamento de convidados vinculados a uma festa. Requer autenticaÃ§Ã£o JWT.

| MÃ©todo | Rota Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  | DescriÃ§Ã£o Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  |
|--------|-----------------------------------|--------------------------------------|
| POST Â  | `/convidados` Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   | Adiciona um novo convidado Ã  festa. Â  |
| GET Â  Â  | `/convidados` Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   | Lista todos os convidados da festa. Â  |
| GET Â  Â  | `/convidados/buscar` Â  Â  Â  Â  Â  Â    | Busca convidados pelo nome. Â  Â  Â  Â  Â  |
| GET Â  Â  | `/convidados/:idConvidado` Â  Â  Â   | Busca um convidado especÃ­fico por ID. |
| PATCH Â  | `/convidados/:idConvidado` Â  Â  Â   | Atualiza um convidado especÃ­fico. Â  Â  |
| DELETE  | `/convidados/:idConvidado` Â  Â  Â   | Remove um convidado especÃ­fico. Â  Â  Â  |
| PATCH Â  | `/convidados/:idConvidado/checkin`| Realiza o check-in de um convidado. Â  |
| PATCH Â  | `/convidados/:idConvidado/checkout`| Realiza o check-out de um convidado. |

#### ðŸ”¸ POST `/festa/:idFesta/convidados`

Exemplo de Corpo Completo:

```json
{
  "nome_convidado": "Pedro Alves (Filho)",
  "idade_convidado": 8,
  "data_nascimento": "2017-10-20",
  "tipo_convidado": "CRIANCA_PAGANTE",
  "e_crianca_atipica": false,
  "telefone_convidado": null,
  "nome_responsavel": "Marcos Alves (Pai)",
  "telefone_responsavel": "79955667788",
  "nome_acompanhante": "Marcos Alves (Pai)",
  "telefone_acompanhante": "79955667788",
  "observacao_convidado": "Alergia a lactose.",
  "confirmou_presenca": "SIM"
}
```

#### ðŸ”¸ GET `/festa/:idFesta/convidados/buscar`

Exemplo de Uso: `GET /festa/15/convidados/buscar?nome=Alves`

#### ðŸ”¸ PATCH `/festa/:idFesta/convidados/:idConvidado`

Exemplo de Corpo: (envie apenas os campos a alterar)

```json
{
  "nome_convidado": "Pedro dos Santos Alves",
  "observacao_convidado": "Alergia a lactose e a amendoim."
}
```

#### ðŸ”¸ PATCH `/festa/:idFesta/convidados/:idConvidado/checkin` | `/checkout`

DescriÃ§Ã£o: Realiza o check-in ou o check-out. **AÃ§Ã£o restrita ao Staff (AdmEspaco)**.

Corpo: Nenhum (ou `{}`).
